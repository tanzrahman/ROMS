<html>
{% load document_review_tags %}
{% load static %}
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="{% static 'js/selectize.js' %}"></script>
    <script src="/static/js/jquery-3.5.1.min.js"></script>
    <link href="/static/css/selectize.css" rel="stylesheet"/>
    <link href="/static/css/bootstrap.css" rel="stylesheet"/>
    <style>
        table {
            page-break-inside: avoid;
        }

        div {
            page-break-inside: avoid;
            page-break-after: always;
        }

        p {
            break-inside: avoid;
            break-after: auto;
        }
    </style>
</head>

<body style='font-family: "Roboto", "Lucida Grande", "DejaVu Sans", "Bitstream Vera Sans", Verdana, Arial, "sans-serif"'>


<!-- new template design -->
<div style="padding-left: 5%; padding-top: 15%">
    <h3 style="text-align: center; padding-bottom: 5%; font-weight: bold">NUCLEAR POWER PLANT COMPANY BANGLADESH LIMITED<br>(NPCBL)</h3>
    <div style="text-align: center">
        <img src="{% static '/npcbl.png' %}" alt="npcbl logo">
    </div>

    <br><br>
    <div style="text-align: right; margin-right: 10%">
        <h4 style="font-weight: bold">APPROVED</h4>
        <h5>Managing Director</h5><br>
        {% if committee_rev.chief_eng_approval.sign_hash %}
            <img id="signature" height="40" width="100"
                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ committee_rev.chief_eng_approval.sign_hash }}">
            <br>
            <hr style="width: 200px; margin-left: auto; margin-right: 0; border-top: 2px solid #000;">
            (Dr. Md. Zahedul Hassan) <br>
            {{ committee_rev.chief_eng_approval.signed_on }}
        {% endif %}
    </div>
    <br><br>
    <div style="text-align: center">
        {% if unit == 0 %}
            <h5 style="font-weight: bold">ROOPPUR NPP<br>UNIT No. 1, 2</h5><br>
        {% elif unit == 1 %}
            <h5 style="font-weight: bold">ROOPPUR NPP<br>UNIT No. 1</h5><br>
        {% elif unit == 2 %}
            <h5 style="font-weight: bold">ROOPPUR NPP<br>UNIT No. 2</h5><br>
        {% else %}
            <h5 style="font-weight: bold">ROOPPUR NPP<br>UNIT UNDEFINED</h5><br>
        {% endif %}
        <h5>
            {{ task.title }}
            <br>
            {{ task }}
            <br>
            Version {{ form.initial.version_of_doc|extract_version_info }}
        </h5>
    </div>

</div>

    <!-- heading of approval sheet -->

    <div style="padding-left: 5%;">
        <table class="table table-bordered table-responsive" style="width: 100%; border: 1px solid grey; border-collapse: collapse; text-align: center">
            <tr>
                <td style="border:1px solid black;">Rooppur NPP</td>
                <td rowspan="2" style="vertical-align: middle; border: 1px solid black;">
                    <span>{{ task.title }}</span>
                </td>
                <td rowspan="2" style="vertical-align: middle; border: 1px solid black;">
                    <span>{{ task }}</span>
                </td>
            </tr>
            <tr>
                <td style="border: 1px solid black;">Version {{ form.initial.version_of_doc|extract_version_info }}</td>
            </tr>
        </table>
    </div>

<div style="padding-left: 5%;">
    <h3 style="text-align: center; font-weight: bold">Approval Sheet</h3>
    <div>
        <table class="table table-bordered" style="width: 100%; text-align: center;  border:1px solid black; border-collapse: collapse;" >
            <tr>
                <th style="border:1px solid black;"></th>
                <th style="border:1px solid black;">Position</th>
                <th style="border:1px solid black;">Full Name</th>
                <th style="border:1px solid black;">Signature</th>
                <th style="border:1px solid black;">Date</th>
            </tr>
            <tr>
                <td style="border:1px solid black;">Agreed by</td>
                <td style="border:1px solid black;">Chief Superintendent (Addl. Charge)</td>
                <td style="border:1px solid black;">
                    {{ committee_rev.chief_eng_approval.signed_by.get_full_name }}
                </td>
                {% if committee_rev.chief_eng_approval.sign_hash %}
                    <td style="margin-top:5%; border:1px solid black;">
                        <img id="signature" height="40" width="100"
                                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ committee_rev.chief_eng_approval.sign_hash }}">
                    </td>
                    <td style="border:1px solid black;">{{ committee_rev.chief_eng_approval.signed_on }}</td>

                {% endif %}
            </tr>
            <tr>
                <td style="border:1px solid black;">Agreed by</td>
                <td style="border:1px solid black;">Head of Division</td>
                <td style="border:1px solid black;">
                    {{ committee_rev.division_head_approval.signed_by.get_full_name }}
                </td>
                {% if committee_rev.division_head_approval.sign_hash %}
                    <td style="margin-top:5%; border:1px solid black;">
                        <img id="signature" height="40" width="100"
                             src="https://{{ host }}/manpower/user/embedd_signature?hash={{ committee_rev.division_head_approval.sign_hash }}">
                    </td>
                    <td style="border:1px solid black;">{{ committee_rev.division_head_approval.signed_on }}</td>
                {% endif %}
            </tr>

            {% if committee_rev.committee_approval %}
                {% for each in committee_rev.committee_approval.all %}
                    <tr>
                        <td style="border:1px solid black;">Agreed by</td>
                        <td style="border:1px solid black;">{{ each.signed_by.profile.npcbl_designation }}</td>
                        <td style="border:1px solid black;">
                            {{ each.signed_by.get_full_name }}
                            <br>
                            {{ each.signed_by }}
                        </td>
                        <td style="margin-top:5%; border:1px solid black;">
                            <img id="signature_{{ forloop.counter }}" height="40" width="100"
                                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ each.sign_hash }}">
                        </td>
                        <td style="border:1px solid black;">
                            {{ each.signed_on }}
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </table>
    </div>
</div>

<div style='padding-left:5%;'>
    <div style="padding-bottom:1% ">
        {% if form %}
            <h2>Feedback Details</h2>
            {% for each in form %}
                <p style="text-align: justify-all">
                    <span style="font-weight: bold">Question-{{ forloop.counter }}: {{ each.label }}</span>
                    <br>
                    <span style="width: 95%">
                    <b>Answer: </b>
                    {{ each.initial|linebreaksbr }}
                    <br>
                </span>
                </p>
            {% endfor %}
        {% endif %}
    </div>
</div>

<div style="padding-left: 5%; padding-bottom: 2%; width: 95%">
    <h2 style="text-align: center">Committee Review Comments</h2>

    <table class="table table-bordered">
        <thead>
        <th>SL. No</th>
        <th>Section No</th>
        <th>Original Text</th>
        <th>Proposed Text</th>
        <th>Remarks</th>
        </thead>
        {% for each in committee_rev_cmnt %}
            <tr>
                <td style="width: 3%">{{ forloop.counter }}</td>
                <td style="width: 7%">{{ each.section_no }}</td>
                <td style="width: 35%; word-wrap: anywhere;">{{ each.original_text|linebreaks }}</td>
                <td style="width: 35%; word-wrap: anywhere;">{{ each.proposed_text|linebreaks }}</td>
                <td style="width: 20%; word-wrap: anywhere;">{{ each.remarks|linebreaks }}</td>
            </tr>
        {% endfor %}
    </table>
</div>

<!--
<div style="padding-left: 5%;">
    <div>
        {% if committee_rev.committee_approval %}
            <table class="table table-bordered table-responsive" style="width: 100%">
                 <tr>
                    <td colspan="3">
                        <h3>Approval Sheet</h3>
                    </td>
                </tr>
                <tr style="text-align: left">
                    <td colspan="3">
                        <span><b>Document Code: </b>{{ task }}</span><br>
                        <span><b>Document Version: </b>{{ form.initial.version_of_doc|extract_version_info }}</span><br>
                        <span><b>Title: </b>{{ task.title }}</span>
                    </td>
                </tr>
                <tr>
                    <th>Recommendation By</th>
                    <th>Recommendation</th>
                    <th>Signature</th>
                    <th>Remarks</th>
                </tr>
                {% for each in committee_rev.committee_approval.all %}
                    <tr>
                        <td>
                            {{ each.signed_by.get_full_name }}
                            <br>
                            {{ each.signed_by }}
                        </td>
                        <td>{{ each.remarks|remarks_display_str }}</td>
                        <td style="margin-top:5%">
                            <img id="signature_{{ forloop.counter }}" height="40" width="100"
                                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ each.sign_hash }}">
                            <br>
                            {{ each.signed_on }}
                        </td>
                    </tr>
                {% endfor %}
                <tr>
                    <td>
                        {{ committee_rev.division_head_approval.signed_by.get_full_name }}
                        <br>
                        Head of Division
                    </td>
                    <td>
                        {{ committee_rev.division_head_approval.remarks|remarks_display_str }}
                    </td>
                    <td style="margin-top:5%">
                        {% if committee_rev.division_head_approval.sign_hash %}
                            <img id="signature" height="40" width="100"
                                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ committee_rev.division_head_approval.sign_hash }}">
                            <br>
                            {{ committee_rev.division_head_approval.signed_on }}
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td>
                        {{ committee_rev.chief_eng_approval.signed_by.get_full_name }}
                        <br>
                        Chief Superintendent (Addl. Charge)
                    </td>
                    <td>
                        {{ committee_rev.chief_eng_approval.remarks|remarks_display_str }}
                    </td>
                    <td style="margin-top:5%">
                        {% if committee_rev.chief_eng_approval.sign_hash %}
                            <img id="signature" height="40" width="100"
                                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ committee_rev.chief_eng_approval.sign_hash }}">
                            <br>
                            {{ committee_rev.chief_eng_approval.signed_on }}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td>
                        Dr. Md. Zahedul Hassan
                        <br>
                        Managing Director
                    </td>
                    <td>
                        {{ committee_rev.sd_approval.remarks|remarks_display_str }}
                    </td>
                    <td style="margin-top:5%">
                        {% if committee_rev.sd_approval.sign_hash %}
                            <img id="signature" height="40" width="100"
                                 src="https://{{ host }}/manpower/user/embedd_signature?hash={{ committee_rev.sd_approval.sign_hash }}">
                            <br>
                            {{ committee_rev.sd_approval.signed_on }}
                        {% endif %}
                    </td>
                    <td>{{ committee_rev.sd_approval.comments }}</td>
                </tr>
            </table>
        {% endif %}
    </div>
</div> -->


<script>
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    function to_pdf()
    {
        //window.print()
    }
    async function load_all_sigs() {
        var sig_count = {{committee_rev.committee_approval.all.count}};
        await sleep(500);
        for (i = 1; i <= sig_count; i++) {
            var item = 'signature_' + i;
            var src = document.getElementById(item).src;
            document.getElementById(item).src = src;
            await sleep(600);
        }
        to_pdf();
    }

    $(document).ready(function () {
        load_all_sigs();
    });
</script>
</body>
</html>
